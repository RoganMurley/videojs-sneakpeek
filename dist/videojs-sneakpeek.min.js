"use strict";var _video=require("video.js");var _video2=_interopRequireDefault(_video);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var defaults={width:0,height:0,basePath:""};function getComputedStyle(e,t){return function(n){if(window.getComputedStyle){return window.getComputedStyle(e,t)[n]}return e.currentStyle[n]}}function offsetParent(e){if(e.nodeName!=="HTML"&&getComputedStyle(e)("position")==="static"){return offsetParent(e.offsetParent)}return e}function getScrollOffset(){if(window.pageXOffset){return{x:window.pageXOffset,y:window.pageYOffset}}return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}function parseImageLink(e){var t=e.indexOf("#");if(t===-1){return{src:e,w:0,h:0,x:0,y:0}}var n=e.substring(0,t);var r=e.substring(t+1);if(r.substring(0,5)!=="xywh="){return{src:defaults.basePath+n,w:0,h:0,x:0,y:0}}var a=r.substring(5).split(",");return{src:defaults.basePath+n,w:+a[2],h:+a[3],x:+a[0],y:+a[1]}}_video2.default.plugin("thumbnails",function(e){var t=void 0,n=void 0;defaults.basePath=e.basePath||defaults.basePath;var r=Object.assign({},defaults,e);var a=this;a.ready(function(){t=a.remoteTextTracks();o();if(!n){t.addEventListener("addtrack",o)}});function o(){if(n){return}for(var e=0;e<t.length;e++){if(t[e].kind==="metadata"){n=t[e];n.mode="hidden";break}}if(!n){return}if(navigator.userAgent.toLowerCase().indexOf("android")!==-1){var o=a.controlBar.progressControl;var i=function e(){o.addClass("fake-active")};var s=function e(){o.removeClass("fake-active")};o.on("touchstart",i);o.on("touchend",s);o.on("touchcancel",s)}var u=document.createElement("div");u.className="vjs-thumbnail-holder";var f=document.createElement("img");u.appendChild(f);f.className="vjs-thumbnail";var d=a.duration();a.on("durationchange",function(){d=a.duration()});a.on("loadedmetadata",function(){d=a.duration()});var l=a.controlBar.progressControl;l.el().appendChild(u);function c(e){var t=getScrollOffset().x;var o=offsetParent(l.el()).getBoundingClientRect();var i=(o.width||o.right)+t;var s=e.pageX;if(e.changedTouches){s=e.changedTouches[0].pageX}var c=s||e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c-=offsetParent(l.el()).getBoundingClientRect().left+t;var h=Math.floor((c-l.el().offsetLeft)/l.width()*d);var v=n&&n.cues.length;var g=0;var m=void 0;while(g<v){var p=n.cues[g];if(p.startTime<=h&&p.endTime>=h){m=parseImageLink(p.text);break}g++}if(typeof m==="undefined"){return}if(m.src&&f.src!==m.src){var w="";if(m.src[0]==="/"){w=a.currentSrc();w=w.substring(0,w.lastIndexOf("/"))}f.src=w+m.src}if(m.w===0){m.w=r.width}if(m.h===0){m.h=r.height}if(u.style.width!==m.w||u.style.height!==m.h){u.style.width=m.w+"px";u.style.height=m.h+"px"}f.style.left=-m.x+"px";f.style.top=-m.y+"px";f.style.clip="rect("+m.y+"px,"+(m.w+m.x)+"px,"+(m.y+m.h)+"px,"+m.x+"px)";var y=m.w;var x=y/2;if(c+x>i){c=i-y}else if(c<x){c=0}else{c=c-x}u.style.left=c+"px"}l.on("mousemove",c);l.on("touchmove",c);function h(){u.style.left="-1000px"}l.on("mouseout",h);l.on("touchcancel",h);l.on("touchend",h);a.on("userinactive",h)}});