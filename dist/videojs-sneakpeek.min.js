"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){e[n]=r[n]}}}return e};var _video=require("video.js");var _video2=_interopRequireDefault(_video);var _window=require("global/window");var _window2=_interopRequireDefault(_window);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var defaults={width:0,height:0,basePath:""};function getComputedStyle(e,t){return function(r){if(_window2.default.getComputedStyle){return _window2.default.getComputedStyle(e,t)[r]}return e.currentStyle[r]}}function offsetParent(e){if(e.nodeName!=="HTML"&&getComputedStyle(e)("position")==="static"){return offsetParent(e.offsetParent)}return e}function getScrollOffset(){if(_window2.default.pageXOffset){return{x:_window2.default.pageXOffset,y:_window2.default.pageYOffset}}return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}function parseImageLink(e){var t=e.indexOf("#");if(t===-1){return{src:e,x:0,y:0,w:0,h:0}}var r=e.substring(0,t);var n=e.substring(t+1);if(n.substring(0,5)!=="xywh="){return{src:defaults.basePath+r,x:0,y:0,w:0,h:0}}var a=n.substring(5).split(",");return{src:defaults.basePath+r,x:+a[0],y:+a[1],w:+a[2],h:+a[3]}}_video2.default.plugin("sneakpeek",function(e){defaults.basePath=e.basePath||defaults.basePath;var t=_extends({},defaults,e);var r=this;var n=[],a=void 0;r.ready(function(){n=r.remoteTextTracks();o();if(!a){n.addEventListener("addtrack",o)}});function o(){if(a){return}for(var e=0;e<n.length;e++){if(n[e].kind==="metadata"){a=n[e];a.mode="hidden";break}}if(!a){return}if(navigator.userAgent.toLowerCase().indexOf("android")!==-1){var o=r.controlBar.progressControl;var i=function e(){o.addClass("fake-active")};var s=function e(){o.removeClass("fake-active")};o.on("touchstart",i);o.on("touchend",s);o.on("touchcancel",s)}var u=document.createElement("div");u.className="vjs-sneakpeek-holder";var d=document.createElement("img");u.appendChild(d);d.className="vjs-sneakpeek";var f=r.duration();r.on("durationchange",function(){f=r.duration()});r.on("loadedmetadata",function(){f=r.duration()});var l=r.controlBar.progressControl;l.el().appendChild(u);function c(e){var n=getScrollOffset().x;var o=offsetParent(l.el()).getBoundingClientRect();var i=e.pageX;if(e.changedTouches){i=e.changedTouches[0].pageX}var s=(o.width||o.right)+n;var c=i||e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c-=offsetParent(l.el()).getBoundingClientRect().left+n;var v=Math.floor((c-l.el().offsetLeft)/l.width()*f);var h=a&&a.cues.length;var g=0;var p=void 0;while(g<h){var w=a.cues[g];if(w.startTime<=v&&w.endTime>=v){p=parseImageLink(w.text);break}g++}if(typeof p==="undefined"){return}if(p.src&&d.src!==p.src){var m="";if(p.src[0]==="/"){m=r.currentSrc();m=m.substring(0,m.lastIndexOf("/"))}d.src=m+p.src}p.w=p.w||t.width;p.h=p.h||t.height;if(u.style.width!==p.w||u.style.height!==p.h){u.style.width=p.w+"px";u.style.height=p.h+"px"}d.style.left=-p.x+"px";d.style.top=-p.y+"px";var y=[p.y,p.w+p.x,p.y+p.h,p.x];d.style.clip="rect("+y.join("px,")+"px)";var x=p.w;var _=x/2;if(c+_>s){c=s-x}else if(c<_){c=0}else{c=c-_}u.style.left=c+"px"}function v(){u.style.left="-1000px"}l.on("mousemove",c);l.on("touchmove",c);l.on("mouseout",v);l.on("touchcancel",v);l.on("touchend",v);r.on("userinactive",v)}});