"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r){if(Object.prototype.hasOwnProperty.call(r,n)){e[n]=r[n]}}}return e};var _video=require("video.js");var _video2=_interopRequireDefault(_video);var _window=require("global/window");var _window2=_interopRequireDefault(_window);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var defaults={width:0,height:0,basePath:""};function getComputedStyle(e,t){return function(r){if(_window2.default.getComputedStyle){return _window2.default.getComputedStyle(e,t)[r]}return e.currentStyle[r]}}function offsetParent(e){if(e.nodeName!=="HTML"&&getComputedStyle(e)("position")==="static"){return offsetParent(e.offsetParent)}return e}function getScrollOffset(){if(_window2.default.pageXOffset){return{x:_window2.default.pageXOffset,y:_window2.default.pageYOffset}}return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}function parseImageLink(e){var t=e.indexOf("#");if(t===-1){return{src:e,w:0,h:0,x:0,y:0}}var r=e.substring(0,t);var n=e.substring(t+1);if(n.substring(0,5)!=="xywh="){return{src:defaults.basePath+r,w:0,h:0,x:0,y:0}}var a=n.substring(5).split(",");return{src:defaults.basePath+r,w:+a[2],h:+a[3],x:+a[0],y:+a[1]}}_video2.default.plugin("sneakpeek",function(e){var t=void 0,r=void 0;defaults.basePath=e.basePath||defaults.basePath;var n=_extends({},defaults,e);var a=this;a.ready(function(){t=a.remoteTextTracks();o();if(!r){t.addEventListener("addtrack",o)}});function o(){if(r){return}for(var e=0;e<t.length;e++){if(t[e].kind==="metadata"){r=t[e];r.mode="hidden";break}}if(!r){return}if(navigator.userAgent.toLowerCase().indexOf("android")!==-1){var o=a.controlBar.progressControl;var i=function e(){o.addClass("fake-active")};var s=function e(){o.removeClass("fake-active")};o.on("touchstart",i);o.on("touchend",s);o.on("touchcancel",s)}var u=document.createElement("div");u.className="vjs-thumbnail-holder";var f=document.createElement("img");u.appendChild(f);f.className="vjs-thumbnail";var d=a.duration();a.on("durationchange",function(){d=a.duration()});a.on("loadedmetadata",function(){d=a.duration()});var l=a.controlBar.progressControl;l.el().appendChild(u);function c(e){var t=getScrollOffset().x;var o=offsetParent(l.el()).getBoundingClientRect();var i=(o.width||o.right)+t;var s=e.pageX;if(e.changedTouches){s=e.changedTouches[0].pageX}var c=s||e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c-=offsetParent(l.el()).getBoundingClientRect().left+t;var v=Math.floor((c-l.el().offsetLeft)/l.width()*d);var h=r&&r.cues.length;var g=0;var p=void 0;while(g<h){var m=r.cues[g];if(m.startTime<=v&&m.endTime>=v){p=parseImageLink(m.text);break}g++}if(typeof p==="undefined"){return}if(p.src&&f.src!==p.src){var w="";if(p.src[0]==="/"){w=a.currentSrc();w=w.substring(0,w.lastIndexOf("/"))}f.src=w+p.src}if(p.w===0){p.w=n.width}if(p.h===0){p.h=n.height}if(u.style.width!==p.w||u.style.height!==p.h){u.style.width=p.w+"px";u.style.height=p.h+"px"}f.style.left=-p.x+"px";f.style.top=-p.y+"px";f.style.clip="rect("+p.y+"px,"+(p.w+p.x)+"px,"+(p.y+p.h)+"px,"+p.x+"px)";var y=p.w;var x=y/2;if(c+x>i){c=i-y}else if(c<x){c=0}else{c=c-x}u.style.left=c+"px"}l.on("mousemove",c);l.on("touchmove",c);function v(){u.style.left="-1000px"}l.on("mouseout",v);l.on("touchcancel",v);l.on("touchend",v);a.on("userinactive",v)}});